{"ast":null,"code":"import{createContext,useContext,useState,useEffect}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[token,setToken]=useState(localStorage.getItem('token'));const[loading,setLoading]=useState(true);// Configurazione di axios con il token\nuseEffect(()=>{if(token){axios.defaults.headers.common['Authorization']=`Bearer ${token}`;}else{delete axios.defaults.headers.common['Authorization'];}},[token]);// Carica i dati dell'utente all'avvio\nuseEffect(()=>{const loadUser=async()=>{if(!token){setLoading(false);return;}try{const res=await axios.get('http://localhost:3001/users/me');setUser(res.data);}catch(err){console.error('Errore nel caricamento dell\\'utente:',err);localStorage.removeItem('token');setToken(null);setUser(null);}finally{setLoading(false);}};loadUser();},[token]);// Gestione del token da Google\nuseEffect(()=>{// Controllo se c'è un token nell'URL (da Google OAuth)\nconst urlParams=new URLSearchParams(window.location.search);const tokenFromUrl=urlParams.get('token');if(tokenFromUrl){// Memorizza il token\nlocalStorage.setItem('token',tokenFromUrl);setToken(tokenFromUrl);// Rimuovi il token dall'URL per sicurezza\nwindow.history.replaceState({},document.title,window.location.pathname);}},[]);const login=async(email,password)=>{try{const res=await axios.post('http://localhost:3001/users/login',{email,password});setToken(res.data.token);setUser(res.data.user);// Salva il token nel localStorage\nlocalStorage.setItem('token',res.data.token);return{success:true};}catch(err){var _err$response,_err$response$data;console.error('Errore durante il login:',err);return{success:false,error:((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Credenziali non valide'};}};const register=async userData=>{try{const res=await axios.post('http://localhost:3001/users/register',userData);return{success:true,data:res.data};}catch(err){var _err$response2,_err$response2$data;return{success:false,error:((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||'Errore durante la registrazione'};}};const logout=()=>{// Rimuovi il token dal localStorage e resetta lo stato\nlocalStorage.removeItem('token');setToken(null);setUser(null);delete axios.defaults.headers.common['Authorization'];};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,token,loading,login,logout,register,isAuthenticated:!!token},children:children});};export const useAuth=()=>useContext(AuthContext);","map":{"version":3,"names":["createContext","useContext","useState","useEffect","axios","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","token","setToken","localStorage","getItem","loading","setLoading","defaults","headers","common","loadUser","res","get","data","err","console","error","removeItem","urlParams","URLSearchParams","window","location","search","tokenFromUrl","setItem","history","replaceState","document","title","pathname","login","email","password","post","success","_err$response","_err$response$data","response","message","register","userData","_err$response2","_err$response2$data","logout","Provider","value","isAuthenticated","useAuth"],"sources":["C:/Users/esis/Downloads/M6W4D4/frontend/src/contexts/AuthContext.jsx"],"sourcesContent":["import { createContext, useContext, useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [token, setToken] = useState(localStorage.getItem('token'));\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Configurazione di axios con il token\r\n  useEffect(() => {\r\n    if (token) {\r\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n    } else {\r\n      delete axios.defaults.headers.common['Authorization'];\r\n    }\r\n  }, [token]);\r\n\r\n  // Carica i dati dell'utente all'avvio\r\n  useEffect(() => {\r\n    const loadUser = async () => {\r\n      if (!token) {\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const res = await axios.get('http://localhost:3001/users/me');\r\n        setUser(res.data);\r\n      } catch (err) {\r\n        console.error('Errore nel caricamento dell\\'utente:', err);\r\n        localStorage.removeItem('token');\r\n        setToken(null);\r\n        setUser(null);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadUser();\r\n  }, [token]);\r\n\r\n  // Gestione del token da Google\r\n  useEffect(() => {\r\n    // Controllo se c'è un token nell'URL (da Google OAuth)\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const tokenFromUrl = urlParams.get('token');\r\n    \r\n    if (tokenFromUrl) {\r\n      // Memorizza il token\r\n      localStorage.setItem('token', tokenFromUrl);\r\n      setToken(tokenFromUrl);\r\n      \r\n      // Rimuovi il token dall'URL per sicurezza\r\n      window.history.replaceState({}, document.title, window.location.pathname);\r\n    }\r\n  }, []);\r\n\r\n  const login = async (email, password) => {\r\n    try {\r\n      const res = await axios.post('http://localhost:3001/users/login', { email, password });\r\n      \r\n      setToken(res.data.token);\r\n      setUser(res.data.user);\r\n      \r\n      // Salva il token nel localStorage\r\n      localStorage.setItem('token', res.data.token);\r\n      \r\n      return { success: true };\r\n    } catch (err) {\r\n      console.error('Errore durante il login:', err);\r\n      return { \r\n        success: false, \r\n        error: err.response?.data?.message || 'Credenziali non valide' \r\n      };\r\n    }\r\n  };\r\n\r\n  const register = async (userData) => {\r\n    try {\r\n      const res = await axios.post('http://localhost:3001/users/register', userData);\r\n      return { success: true, data: res.data };\r\n    } catch (err) {\r\n      return { \r\n        success: false, \r\n        error: err.response?.data?.message || 'Errore durante la registrazione' \r\n      };\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    // Rimuovi il token dal localStorage e resetta lo stato\r\n    localStorage.removeItem('token');\r\n    setToken(null);\r\n    setUser(null);\r\n    delete axios.defaults.headers.common['Authorization'];\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ \r\n      user, \r\n      token,\r\n      loading, \r\n      login, \r\n      logout, \r\n      register,\r\n      isAuthenticated: !!token \r\n    }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => useContext(AuthContext);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}